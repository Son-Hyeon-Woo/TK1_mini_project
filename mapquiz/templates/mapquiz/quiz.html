<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>로드뷰 생성하기</title>
    <!-- custom css CSS 수정 -->
    <style>
        body {
            margin: 7px;
            background-color: #fff;
            }
        @font-face {
            font-family: 'IM_Hyemin-Bold';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2106@1.1/IM_Hyemin-Bold.woff2') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        .Hyemin{ font-family: 'IM_Hyemin-Bold', normal; }
        .italic{ font-style: italic }
        .gohome {
            position: absolute; left : 10px; top : 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            }    
        .custombtn {
            display: inline-block;
            font-weight: 400;
            line-height: 1.5;
            color: #fff;
            background-color: #2a5555;
            border-color: #2a5555;
            text-align: center;
            text-decoration: none;
            vertical-align: middle;
            cursor: pointer;
            user-select: none;
            border: 1px solid transparent;
            padding: 0.4rem 2%;
            font-size: 1.5rem;
            border-radius: 0.25rem;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            }
        .custombtn:hover {
            color: #fff;
            background-color: #244848;
            border-color: #224444;
            }

        .minimap {
            transition : 0.5s;
            position: absolute;
            bottom : 70px;
            right : 6px;
            width: 30%;
            height: 38%;
            border-radius: 30px;
          }

        #hidden_btn {
            position: absolute;
            bottom : 50px;
            left : 50%;
            transform : translate(-50%);
            padding: 0.1rem 38%%;
            font-weight: 400;
            line-height: 1.5;
            color: #2a5555;
            background-color: #fff;
            border-color: #2a5555;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            user-select: none;
            border: 2px solid #2a5555;
            font-size: 1.5rem;
            border-radius: 0.4rem;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 1000;
        
            /* 숨기기 */
            z-index: -1;
            opacity: 0;
        }
        
        .show {
                opacity: 1;
                z-index: 1000;
                transition: all 0.5s;
            }
        
        .window {
                position: relative;
                width: 100%;
                height: 100%;
            }
        
        .popup {
                position : absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #ffffff;
                box-shadow: 0 2px 7px rgba(0, 0, 0, 0.3);
        
                /* 임시 지정 */
                width: 30%;
                height: 80%;
        
            }
        
        .show .popup {
                transform: translate(-50%, -50%);
                transition: all 0.5s;
            }
        
        
    
    
        </style>
</head>
<body>
<nav class="Hyemin" style = 'text-align: center;';>
    <h2>이 곳을 맞춰볼까요?</h2>
    <button class="custombtn gohome Hyemin"  id="submitButton" type="botton" onclick="location.href='http://127.0.0.1:8000/map/home'"> 홈으로 </button></div>
</nav>

<!-- 로드뷰를 표시할 div 입니다 -->
<!-- 로드뷰를 표시할 div 입니다 -->
<div class="masthead" id="roadview" style="width:100%;height:600px;border-radius: 30px"></div>

<div id="map" class = 'minimap'></div>

<p><em>지도를 클릭해주세요!</em></p> 

<div id="clickLatlng" ></div>

<div>
    <button id="show" style = 'visibility : hidden'> 제출하기 </button>
    <div class="background">
        <div class="window">
            <div class="popup">
            <button id="close">팝업닫기</button>
                <div style = "height : 80%; width:100%;" class="popup" id = 'popanswer'></div>
            </div>
            <div>
                <div></div>
        </div>
    </div>
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=82cdfefd8c371330aa8531c5f89338c6"></script>
<script>
var latlong = JSON.parse("{{ latlong_json|escapejs }}");

var roadviewContainer = document.getElementById('roadview'); //로드뷰를 표시할 div
var roadview = new kakao.maps.Roadview(roadviewContainer); //로드뷰 객체
var roadviewClient = new kakao.maps.RoadviewClient(); //좌표로부터 로드뷰 파노ID를 가져올 로드뷰 helper객체

var position = new kakao.maps.LatLng(latlong['lat'], latlong['long']);

// 특정 위치의 좌표와 가까운 로드뷰의 panoId를 추출하여 로드뷰를 띄운다.
roadviewClient.getNearestPanoId(position, 50, function(panoId) {
    roadview.setPanoId(panoId, position); //panoId와 중심좌표를 통해 로드뷰 실행
});
</script>


<!-- 미니맵를 표시할 div 입니다 -->
<!-- 미니맵를 표시할 div 입니다 -->


<script>

    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
    mapOption = { 
        center: new kakao.maps.LatLng(35.87152628630865, 128.60172139697093), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
    };


var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
var temp = document.getElementById('map');
temp.style.width = '20%'
temp.style.height = '26%'

// 지도를 클릭한 위치에 표출할 마커입니다
var marker = new kakao.maps.Marker({ 
    // 지도 중심좌표에 마커를 생성합니다 
    position: map.getCenter() 
}); 
// 지도에 마커를 표시합니다
marker.setMap(map);



temp = document.getElementById('map');

kakao.maps.event.addListener(map, 'mouseout', function() {
    temp.style.width = '20%'
    temp.style.height = '26%'
});
kakao.maps.event.addListener(map, 'mouseover', function() {
    temp.style.width = '30%'
    temp.style.height = '38%'
});
// 지도에 클릭 이벤트를 등록합니다
// 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출합니다
var latlng;
kakao.maps.event.addListener(map, 'click', function(mouseEvent) {  

    // 클릭한 위도, 경도 정보를 가져옵니다 
    // 전역변수로 설정하기
    latlng = mouseEvent.latLng; 
    console.log(latlng);
    
    // 마커 위치를 클릭한 위치로 옮깁니다
    marker.setPosition(latlng);
    
    var message = '클릭한 위치의 위도는 ' + latlng.getLat() + ' 이고, ';
    message += '경도는 ' + latlng.getLng() + ' 입니다';
    
    var resultDiv = document.getElementById('clickLatlng'); 
    resultDiv.innerHTML = message;

    let goanswer = document.getElementById('show');
    goanswer.style.visibility = 'visible';
});

console.log(latlng);

// 팝업용 지도 입니다
function show() {
    document.querySelector(".background").className = "background show";
    var mapContainer2 = document.getElementById('popanswer'), // 지도를 표시할 div 
    mapOption2 = { 
        center: new kakao.maps.LatLng(latlng.getLat(), latlng.getLng()), // 지도의 중심좌표
        level: 5 // 지도의 확대 레벨
    };
    // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
    var ansmap = new kakao.maps.Map(mapContainer2, mapOption2); 
}

function close() {
    document.querySelector(".background").className = "background";
}

document.querySelector("#show").addEventListener("click", show);
document.querySelector("#close").addEventListener("click", close);

</script>



</body>
</html>